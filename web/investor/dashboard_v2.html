<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融 - 账户概览
    </title>
    <link rel="stylesheet" href="${static}/vendor/css/bootstrap.min.css">
    <link href="${static}/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="${static}/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="${static}/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="${static}/dist/meixin_invest/css/dashboard.min.css" rel="stylesheet">
    <#include "includes/oneapm.html" />
    <#include "includes/ga.html" />
    <script>
        var _hmt = _hmt || [];
        (function () {
                    var hm = document.createElement("script");
                    hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
    </script>
    <!--[if lt IE 9]>
    <script src="${static}/vendor/js/html5shiv"></script>
    <script src="${static}/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div id="wrapper" class="customer">
    <#include "includes/navbar.html" />
    <div class="container-fluid">
        <section style="margin-top: 60px;">
            <div class="row dashboard_tab_bar">
                <ul class="nav nav-tabs" role="tablist">
                    <li role="description" class="active"><a href="#01" aria-controls="home" role="tab"
                                                             data-toggle="tab">投资概览</a></li>
                    <li role="description"><a href="#02" aria-controls="profile" role="tab" data-toggle="tab">账户信息</a>
                    </li>
                    <li role="description"><a href="#03" aria-controls="messages" role="tab" data-toggle="tab">相关文件</a>
                    </li>
                    <li role="description"><a href="#04" aria-controls="messages" role="tab" data-toggle="tab">账户设置</a>
                    </li>
                </ul>
                <#if promotion!= null>
                    <a href="javascript:;" class="red_packets"></a>
                    <div class="activity_message"><p class="text">${promotion.title}</p></div>
                </#if>
            </div>
            <div class="contaniner">
                <div class="row">
                    <div class="col-sm-offset-1 col-sm-10 col-xs-12">
                        <#if err_msg >
                            <div style="color: red; padding-top: 10px;"><span class="glyphicon glyphicon-info-sign"
                                                 aria-hidden="true"></span>${err_msg}</div>
                        </#if>
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="01">
                                <div class="dashboard_invest_total dashboard_table_border text-center">
                                    <h3 class="text-center">投资概览</h3>
                                    <ul>
                                        <li>
                                            <img src="${static}/meixin_invest/img/dashboard_icon01_120x120.png"/>
                                            <p>已投项目<br><span>${investments.total_invest_number}</span></p>
                                        </li>
                                        <li>
                                            <img src="${static}/meixin_invest/img/dashboard_icon02_120x120.png"/>
                                            <p>投资总额<br><span>${investments.total_invest_amount}</span></p>
                                        </li>
                                        <li style="border-right: none;">
                                            <img src="${static}/meixin_invest/img/dashboard_icon03_120x120.png"/>
                                            <p>累计收益<br><span>${investments.total_returned_amount}</span></p>
                                        </li>
                                    </ul>
                                </div>
                                <div class="dashboard_my_invest dashboard_table_border text-center">
                                    <h3 class="text-center">我的投资</h3>
                                    <table class="table table-striped text-center">
                                        <thead>
                                        <tr>
                                            <th>投资产品</th>
                                            <th>投资类型</th>
                                            <th>投资日期</th>
                                            <th>投资总额</th>
                                            <th>体验金</th>
                                            <th>累计收益</th>
                                            <th>状态</th>
                                            <th>认购合同</th>
                                            <th>可提现金额</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <#if investments.order_list >
                                            <tbody>
                                            <#list investments.order_list as order >
                                                <tr>
                                                    <td>${order.product_name}</td>
                                                    <td>${order.investment_type}</td>
                                                    <td>${order.confirm_date}</td>
                                                    <td>${order.invest_amount}</td>
                                                    <td>${order.promotion_value}</td>
                                                    <td>${order.interest_amount}</td>
                                                    <td style="color: red;">${order.investment_status}</td>
                                                    <#if order.sub_doc_url !=null>
                                                        <td><a href="${media}${order.sub_doc_url}"
                                                               target="_blank">认购合同</a></td>
                                                        <#else>
                                                            <td><a id="${order.fa_subscription_id}" href=""
                                                                   target="_blank">认购合同</a></td>
                                                    </#if>

                                                    <td>${order.interest_amount}</td>
                                                    <td>
                                                        <#if order.interest_amount!="0">
                                                            <button style="color: #337ab7;border: none;
                                                           background: none;font-weight:normal;"
                                                                    type="button"
                                                                    data-toggle="modal"
                                                                    data-product_name="${order.product_name}"
                                                                    data-order_id="${order.order_id}"
                                                                    data-interest_amount="${order.interest_amount}"
                                                                    data-invest_amount="${order.invest_amount}"
                                                                    data-target="#popup"
                                                            <#if order.withdraw_amount=="0">disabled="disabled"
                                                            </#if>
                                                            class="btn_popup">立即提现
                                                            <#if
                                                                    order.withdraw_amount=="0"><a title="
本次提现已申请，下次申请提现时间为2016.10.15，请保持联系方式畅通，如有疑问请联系invest@meixinfinance.com。"><span class="glyphicon glyphicon-question-sign"
                                                                              aria-hidden="true"></span></a></#if>
                                                            </button>
                                                        </#if>
                                                    </td>
                                                </tr>
                                            </#list>
                                            </tbody>
                                        </#if>
                                    </table>
                                </div>
                                <div class="dashboard_my_appointment dashboard_table_border text-center">
                                    <h3 class="text-center">我的预约</h3>
                                    <table class="table table-striped text-center">
                                        <thead>
                                        <tr>
                                            <th>预约产品</th>
                                            <th>感兴趣金额</th>
                                            <th>提交日期</th>
                                            <th>状态</th>
                                        </tr>
                                        </thead>
                                        <#if appointment_list >
                                            <tbody>
                                            <#list appointment_list as appointment >
                                                <tr>
                                                    <td>${appointment.product_name}</td>
                                                    <td>${appointment.interested_amount}</td>
                                                    <td>${appointment.appointment_date}</td>
                                                    <td>${appointment.diaplay_status}</td>
                                                </tr>
                                            </#list>
                                            </tbody>
                                        </#if>
                                    </table>
                                    <#include "investor/payment.html"/>
                                </div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="02">
                                <div class="dashboard_info dashboard_table_border">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th colspan="2">投资人信息</th>
                                        </tr>
                                        </thead>
                                        <form>
                                            <tbody>
                                            <tr>
                                                <td>账户类型</td>
                                                <td class="td-with-padding">${investor_profile.investor_type_display}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>姓名</td>
                                                <td><input id="real_name" type="text" readonly=""
                                                           value="${investor_profile.real_name}" pattern="[A-Za-z]"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>证件号</td>
                                                <td><input id="id_card_code" type="text" readonly=""
                                                           value="${investor_profile.id_card_code}"/></td>
                                            </tr>
                                            <tr>
                                                <td>手机号</td>
                                                <td class="td-with-padding">${user.phone}</td>
                                            </tr>
                                            <tr>
                                                <td>邮箱</td>
                                                <td class="td-with-padding">${user.email}</td>
                                            </tr>
                                            <tr>
                                                <td>出生日期</td>
                                                <td><input id="date_of_birth" type="text" readonly=""
                                                           placeholder="YYYY-MM-DD"
                                                           value="${investor_profile.date_of_birth}" maxlength="10"/>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </form>
                                    </table>
                                </div>
                                <div class="dashboard_id_image dashboard_upload_image col-sm-5 col-sm-offset-1">
                                    <p>身份证照片</p>
                                    <#if investor_profile.identification_card_photo != "meixin_invest/user/default.png" >
                                        <img src="${media}${investor_profile.identification_card_photo}">
                                        <#else>
                                            <img src="${static}/meixin_invest/img/dashboard/dashboard_id_placeholder_650x396.png">
                                    </#if>
                                </div>
                                <div class="dashboard_passport_image dashboard_upload_image col-sm-5">
                                    <p>护照照片</p>
                                    <#if investor_profile.passport_photo != "meixin_invest/user/default.png" >
                                        <img src="${media}${investor_profile.passport_photo}">
                                        <#else>
                                            <img src="${static}/meixin_invest/img/dashboard/dashboard_passport_placeholder_650x396.png">
                                    </#if>
                                </div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="03">
                                <div class="dashboard_files dashboard_table_border text-center">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th>文件名</th>
                                            <th>文件类型</th>
                                        </tr>
                                        </thead>

                                    </table>
                                </div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="04">
                                <div class="dashboard_setup col-sm-offset-1 col-sm-10">
                                    <ul class="nav nav-tabs" role="tablist">
                                        <li role="setup" class="active"><a href="#04-01" aria-controls="home"
                                                                           role="subtab" data-toggle="tab">账户类型修改</a>
                                        </li>
                                        <li role="setup"><a href="#04-02" aria-controls="profile" role="subtab"
                                                            data-toggle="tab">证件照片修改</a></li>
                                        <li role="setup"><a href="#04-03" aria-controls="messages" role="subtab"
                                                            data-toggle="tab">重置密码</a></li>
                                    </ul>
                                    <div class="tab-content col-sm-12">
                                        <div role="tabpanel" class="tab-pane active" id="04-01">
                                            <form method="post">
                                                ${csrf_token}
                                                <div class="form-group col-sm-10">
                                                    <label>请选择您的投资人类型</label>
                                                    <select id="id_investor_type" name="investor_type">
                                                        <option value="1"
                                                        <#if investor_profile.investor_type == 1 >selected="selected"
                                                        </#if>
                                                        >国际投资人</option>
                                                        <option value="2"
                                                        <#if investor_profile.investor_type == 2 >selected="selected"
                                                        </#if>
                                                        >美国合格投资人</option>
                                                        <option value="3"
                                                        <#if investor_profile.investor_type == 3 >selected="selected"
                                                        </#if>
                                                        >非美国合格投资人</option>
                                                    </select>
                                                </div>
                                                <div class="col-sm-2">
                                                    <button class="btn btn-primary" type="submit"
                                                            name="investor-type-submit">保存修改
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div role="tabpanel" class="tab-pane" id="04-02">

                                            <form method="post" enctype="multipart/form-data"
                                                  action="/web/investor/upload_photo">
                                                ${csrf_token}
                                                <div class="dashboard_id_image dashboard_upload_image col-sm-5">
                                                    <p>身份证照片</p>
                                                    <img src="${static}/meixin_invest/img/upload_id_placeholder_188x144.png"/>
                                                    <div class="dashboard_mask">
                                                        <a>选择图片</a>
                                                        <input id="id_identification_card_photo"
                                                               name="identification_card_photo" type="file">
                                                    </div>
                                                </div>
                                                <div class="dashboard_passport_image dashboard_upload_image col-sm-5">
                                                    <p>护照照片</p>
                                                    <img src="${static}/meixin_invest/img/upload_passport_placeholder_185x143.png"/>
                                                    <div class="dashboard_mask">
                                                        <a>选择图片</a>
                                                        <input id="id_passport_photo" name="passport_photo" type="file">
                                                    </div>
                                                </div>
                                                <div class="col-sm-2">
                                                    <button class="btn btn-primary" type="submit"
                                                            name="photo-upload-submit">保存修改
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                        <div role="tabpanel" class="tab-pane" id="04-03">
                                            <form method="post" id="password-update-submit">
                                                ${csrf_token}
                                                <div class="form-group col-sm-10">
                                                    <label>请输入原密码</label>
                                                    <input class="form-control" id="id_old_password" name="old_password"
                                                           required="True" type="password">
                                                    <br>

                                                    <label>请输入新密码</label>
                                                    <input aria-describedby="sizing-addon1" class="form-control"
                                                           id="id_password" name="password" required="True"
                                                           type="password">
                                                    <br>

                                                    <label>请确认新密码</label>
                                                    <input aria-describedby="sizing-addon1" class="form-control"
                                                           id="id_password_confirm" name="password_confirm"
                                                           required="True" type="password">
                                                    <div class="error_mes" style="color: red"></div>
                                                </div>
                                                <div class="col-sm-2">
                                                    <button class="btn btn-primary" type="submit"
                                                            name="password-update-submit">保存修改
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
<#include "includes/footer.html" />
<link rel="shortcut icon" type="image/png" href="${static}/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="${static}/vendor/css/font-awesome.min.css">
<script src="${static}/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="${static}/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="${static}/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="${static}/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('.btn_popup').each(function () {
            $(this).unbind('click').click(function () {
                $('#order_id').val($(this).attr('data-order_id'));
                $('#interest_amount').val($(this).attr('data-interest_amount'));
                $('#product_title').html($(this).attr('data-product_name') + '提现');
                $('#invest_amount').val($(this).attr('data-invest_amount'));
            });
        });
        $('.red_packets').hover(function () {
            $('.activity_message').show();
        }, function () {
            $('.activity_message').hide();
        });
        $('#show_preview').on('click', function () {
            var bool = false;
            if ($('#id_user_name').val() == '') {
                alert('请填写姓名!');
            }
            else if ($('#id_user_address').val() == '') {
                alert('请填写居住地址!');
            }
            else if ($('#id_bank_name').val() == '') {
                alert('请填写银行账户!');
            }
            else if ($('#id_swift_code').val() == '' && $('#id_routing_number').val() == '') {
                alert('请填写Swift Code 或 ABA Number!');
            }
            else if ($('#bank-telephone-number').val() == '') {
                alert('请填写收款银行电话!');
            }
            else if ($('#bank-telephone-address').val() == '') {
                alert('收款银行地址!');
            }
            else {
                bool = true;
            }
            if (bool) {
                $('.modal-body').css('display', 'none');
                $('.modal-body-success').css('display', 'block');
                $('.amount_totle').html($('#invest_amount').val());
                $('.used_amount').html($('#interest_amount').val());
                $('.payment_method').html($('#id_payment_method').val());
                $('.user_name').html($('#id_user_name').val());
                $('.user_address').html($('#id_user_address').val());
                $('.bank_card').html($('#id_bank_name').val());
                if ($('#id_swift_code').val() != '') {
                    $('.bank_number').html($('#id_swift_code').val());
                } else {
                    $('.bank_number').html($('#id_routing_number').val());
                }
                $('.bank_phone').html($('#bank-telephone-number').val());
                $('.bank_address').html($('#bank-telephone-address').val());
            }
        });
        $('#back_prev').on('click', function () {
            $('.modal-body').css('display', 'block');
            $('.modal-body-success').css('display', 'none');
        });
        $('#wechat-popover').popover({
            html: true,
            placement: 'bottom',
            trigger: 'hover',
            content: '<img style="width: 200px;padding:0;margin:0;" src="${static}/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>
<script src="${static}/dist/meixin_invest/js/dashboard.min.js"></script>
<script src="${static}/dist/meixin_invest/js/jquery.cookie.min.js"></script>
<script>
    $(document).ready(function () {
        <#if investments.order_list >
        <#list investments.order_list as order >
        get_subscription_archived_pdf_url('${order.fa_subscription_id}');
        </#list>
        </#if>
    });

    function get_subscription_archived_pdf_url(subscription_id) {
        $.ajax({
            url: '/fund_america/subscription_agreements' + '/' + subscription_id,
            dataType: 'json',
            method: 'GET',
            async: true,
            data: {},
            success: function (result, status) {
                $("#" + subscription_id).attr("href", result.archived_pdf_url)
            },
            error: function (response) {
                console.log(response);
            },
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('access_token'));
            }
        });
    }

    function inputValueChange(field, value) {
        $.ajax({
            url: '/api/investor/update_account',
            dataType: 'json',
            method: 'post',
            async: false,
            data: {
                "field": value
            },
            success: function (result, status) {
                console.log(result);
            },
            error: function (response) {
                console.log(response);
            },
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('access_token'));
            }
        });
    }
</script>
</body>
</html>
