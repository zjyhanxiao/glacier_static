<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融|投资流程
    </title>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script>
        var token1 = $.cookie('mx_token');
        var token2 = $.cookie('mx_secret');
        if (token1==undefined || token2==undefined) {
            window.location = '/login.html';
        }
    </script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/is_ok.min.js"></script>
    <link rel="stylesheet" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/css/bootstrap.min.css">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/fa_invest.min.css" rel="stylesheet">
    <script>
        var _hmt = _hmt || [];
        (function () {
                    var hm = document.createElement("script");
                    hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
    </script>
    <!--[if lt IE 9]>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/html5shiv"></script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="ajax_wait">
    <div class="ajax_wait_gif"><img src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/img/Unknown.gif" alt=""></div>
    <p>哎吆喂！网速似乎有点慢，点击这里<a href="/">跳回首页!</a></p>
</div>
<script>
    setHeight();
    $(window).resize(function () {
        setHeight();
    });
</script>
<div id="wrapper" class="customer">
    @@include('../../includes/header.html')
    <div class="container-fluid">
        <section class="text-center" style="margin-top: 70px;">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="fa-steps-bullets">
                        <div><p class="active"><span>1</span></p>投资人基本信息</div>
                        <div><p><span>2</span></p>合格投资人身份</div>
                        <div><p><span>3</span></p>合格投资人信息</div>
                        <div><p><span>4</span></p>投资者身份</div>
                        <div><p><span>5</span></p>确认投资</div>
                        <hr/>
                        <span class="clearfix"></span>
                    </div>
                    <form class="fa-steps col-sm-10 col-sm-offset-1" data-parsley-validate>
                        <div class="step-section label-left">
                            <label>Full Name:</label>
                            <input id="full-name" class="form-control" required="">
                            <label>SSN:</label>
                            <input id="ssn" name="ssn" class="form-control" required=""
                                   data-parsley-pattern="^\d{3}-\d{2}-\d{4}$"
                                   data-parsley-pattern-message="SSN信息输入有误！" placeholder="XXX-XX-XXXX" maxlength="11">
                            <label>Date of Birth:</label>
                            <input type="text" id="birth-date" name="birthdate" placeholder="YYYY-MM-DD"
                                   class="form-control" required=""
                                   data-parsley-pattern="/(^(19|[2-9][0-9])\d\d[\-](((0[1-9]|1[012])[\-](0[1-9]|1[0-9]|2[0-8]))|((0[13578]|1[02])[\-](29|30|31))|((0[4,6,9]|11)[\-](29|30)))$)|(^(19|[2-9][0-9])(00|04|08|12|16|20|24|28|32|36|40|44|48|52|56|60|64|68|72|76|80|84|88|92|96)[\-]02[\-]29$)/"
                                   maxlength="10" data-parsley-pattern-message="Invalid Date of Birth format">
                            <label>Street Address:</label>
                            <input id="street" class="form-control" required="" onblur="ReplaceDot('street')">
                            <label>Apartment Number:</label>
                            <input id="apt-number" class="form-control" onblur="ReplaceDot('apt-number')">
                            <label>City:</label>
                            <input id="city" class="form-control" required="" onblur="ReplaceDot('city')">
                            <label>State:</label>
                            <select id="state" class="form-control bfh-states usa-state-field-style"
                                    data-country="US" data-state="NY" required=""></select>
                            <label>Zip Code:</label>
                            <input id="zipcode" class="form-control" required="">
                        </div>
                        <div class="step-navigation">
                            <button type="button" class="next btn btn-primary pull-right" id="submit_step_one">下一步</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>
@@include('../../includes/footer.html')
<link rel="shortcut icon" type="image/png" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/css/font-awesome.min.css">
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('#wechat-popover').popover({
            html: true,
            placement: 'bottom',
            trigger: 'hover',
            content: '<img style="width: 200px;padding:0;margin:0;" src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>
<script>
    $(function () {
        //验证登录
        Ajax_Data({
            "url": baseUrl + "/auth/authentication",
            "data": cookie_tooken,
            "fn": is_login,
            "no_login": no_login
        });
        function no_login() {
            window.location = '/login.html';
        }

        //is_login  调取登录接口
        function is_login(res) {
            $('.navbar ul li:last-child').html('<a class="btn btn-min-width" href="/investor/dashboard.html">我的账户</a>');
            $('.navbar ul li:nth-last-child(2)').html('<a class="btn btn-min-width-sm logout" href="javascript:;">退出</a>');
            $('.ajax_wait p,.ajax_wait').hide();

            // 获取profile信息
            var get_profile_data = {
                "fields": "real_name,ssn,date_of_birth,mailing_address_street,mailing_address_apartment,mailing_address_city,mailing_address_region,mailing_address_postal_code"
            };
            get_profile_data = $.extend({}, get_profile_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/profile/get",
                "data": get_profile_data,
                "fn": get_profile
            });

            $('#submit_step_one').on('click', function () {
                $(this).prop('disabled',true);
                var img_src = $('#id_card_photo').siblings('img').attr('src');
                var passport_photo_img = $('#passport_photo').siblings('img').attr('src');
                if (!default_id_card_photo) {
                    $('#id_card_photo').prop("required", false);
                }
                if ($('.fa-steps').parsley().validate()) {
                    $('.ajax_wait').show();
                    setTimeout(function () {
                        $('.ajax_wait p').show();
                    }, 3e3);
                    // 创建订单
                    if (is_new) {
                        var create_order_data = {
                            "product_id": product_id,
                            "invest_amount": product_invest_amount
                        };
                        create_order_data = $.extend({}, create_order_data, cookie_tooken);
                        Ajax_Data({
                            "type": "post",
                            "url": baseUrl + "/order/create",
                            "data": create_order_data,
                            "fn": create_order_res,
                            "fail_fn": create_order_fail
                        });
                    }
                    if (is_old) {
                        order_number = getUrlParam("order_number");
                        //上传profile信息
                        var update_profile_data = {};
                        update_profile_data.real_name = $('#full-name').val();
                        update_profile_data.ssn = $('#ssn').val();
                        update_profile_data.date_of_birth = $('#birth-date').val();
                        update_profile_data.mailing_address_street = $('#street').val();
                        update_profile_data.mailing_address_apartment = $('#apt-number').val();
                        update_profile_data.mailing_address_city = $('#city').val();
                        update_profile_data.mailing_address_region = $('#state').val();
                        update_profile_data.mailing_address_postal_code = $('#zipcode').val();
                        update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
                        Ajax_Data({
                            "type": "post",
                            "url": baseUrl + "/profile/update",
                            "data": update_profile_data,
                            "fn": update_profile,
                            "fail_fn": update_profile_fail
                        });
                    }
                    return false;
                }else{
                    $(this).prop('disabled',false);
                }
            })
        }

        //获取profile信息
        function get_profile(d) {
            if (d.real_name != "" && d.real_name != null) {
                $('#full-name').val(d.real_name);
            }
            if (d.ssn != "" && d.ssn != null) {
                $('#ssn').val(d.ssn);
            }
            if (d.date_of_birth != "" && d.date_of_birth != null) {
                $('#birth-date').val(d.date_of_birth);
            }
            if (d.mailing_address_street != "" && d.mailing_address_street != null) {
                $('#street').val(d.mailing_address_street);
            }
            if (d.mailing_address_apartment != "" && d.mailing_address_apartment != null) {
                $('#apt-number').val(d.mailing_address_apartment);
            }
            if (d.mailing_address_city != "" && d.mailing_address_city != null) {
                $('#city').val(d.mailing_address_city);
            }
            if (d.mailing_address_region != "" && d.mailing_address_region != null) {
                $('#state').val(d.mailing_address_region);
            }
            if (d.mailing_address_postal_code != "" && d.mailing_address_postal_code != null) {
                $('#zipcode').val(d.mailing_address_postal_code);
            }
        }

        // 创建订单
        function create_order_res(res) {
            order_number = res;
            //上传profile信息
            var update_profile_data = {};
            update_profile_data.real_name = $('#full-name').val();
            update_profile_data.ssn = $('#ssn').val();
            update_profile_data.date_of_birth = $('#birth-date').val();
            update_profile_data.mailing_address_street = $('#street').val();
            update_profile_data.mailing_address_apartment = $('#apt-number').val();
            update_profile_data.mailing_address_city = $('#city').val();
            update_profile_data.mailing_address_region = $('#state').val();
            update_profile_data.mailing_address_postal_code = $('#zipcode').val();
            update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
            Ajax_Data({
                "type": "post",
                "url": baseUrl + "/profile/update",
                "data": update_profile_data,
                "fn": update_profile,
                "fail_fn": update_profile_fail
            });
        }

        //更新profile信息
        function update_profile(res) {
            $('.ajax_wait p,.ajax_wait').hide();
//            window.location.href = "/fa_invest/international/form_step_2.html?order_number=" + order_number;
            window.location.href = "/fa_invest/american/form_usa_step_2.html?order_number=" + order_number+"&product_id="+product_id;
        }
    })
</script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/bootstrap-formhelpers.min.js"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/bootstrap-formhelpers-states.min.js"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/bootstrap-formhelpers-countries-nousa.zh_CN.min.js"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/parsley.min.js"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/fa_invest_general.min.js"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/fa.min.js"></script>
<script type='text/javascript'>window.BWEUM||(BWEUM={});BWEUM.info = {"stand":true,"agentType":"browser","agent":"//bi-collector.oneapm.com/static/js/bw-send-411.4.5.js","beaconUrl":"bi-collector.oneapm.com/beacon","licenseKey":"VRQIr~Vf3JaYiJQI","applicationID":2280029};</script><script type="text/javascript" src="//bi-collector.oneapm.com/static/js/bw-loader-411.4.5.js"></script> <script>     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');     ga('create', 'UA-66578252-1', 'auto');     ga('send', 'pageview'); </script></body>
</html>

