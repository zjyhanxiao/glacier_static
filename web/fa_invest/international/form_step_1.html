<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融|投资流程
    </title>
    <script src="/version1.0/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/version1.0/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script src="/version1.0/meixin_invest/js/is_ok.js"></script>
    <link rel="stylesheet" href="/version1.0/vendor/css/bootstrap.min.css">
    <link href="/version1.0/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="/version1.0/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="/version1.0/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="/version1.0/dist/meixin_invest/css/fa_invest.min.css" rel="stylesheet">
    <!--    <#include "includes/oneapm.html" />
        <#include "includes/ga.html" />
        <script>
        var _hmt = _hmt || [];
        (function()
        { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); }
        )();
        </script>-->
    <!--[if lt IE 9]>
    <script src="/version1.0/vendor/js/html5shiv"></script>
    <script src="/version1.0/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="ajax_wait">
    <div class="ajax_wait_gif"><img src="/version1.0/dist/meixin_invest/img/Unknown.gif" alt=""></div>
    <p>哎吆喂！网速似乎有点慢，点击这里<a href="/web/index.html">跳回首页!</a></p>
</div>
<script>
    setHeight();
    $(window).resize(function () {
        setHeight();
    });
</script>
<div id="wrapper" class="customer">
    <nav id="navChilantro">     <div class="page-top-bar">联系我们：400-094-1580<a href="http://weibo.com/meixingroup" target="_blank"><img src="/version1.0/meixin_invest/img/top_weibo_icon_55x47.png" /></a><a id="wechat-popover" data-toggle="popover"><img src="/version1.0/meixin_invest/img/top_wechat_icon_57x47.png" /></a>     <div class="top-float-right">         <a href="/web/faq.html">帮助中心</a>         <a href="//news.meixinfinance.com" target="_blank">财经资讯</a>         <a href="/web/about.html#05">加入我们</a>         <a href="/web/about.html#06">联系我们</a>     </div>     </div>     <div class="navbar" role="navigation">         <div class="container" style="padding-bottom: 0;">             <div class="navbar-header" style="display: inline;">                 <a id="logo" href="/" class="navbar-brand">                 </a> <span class="logo-alpha" style="font-size: 12px; float: left;">Beta</span>                 <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">                     <span class="sr-only">Toggle navigation</span>                     <span class="icon-bar"></span>                     <span class="icon-bar"></span>                     <span class="icon-bar"></span>                 </button>             </div>             <div class="navbar-collapse collapse">                 <ul class="nav navbar-nav navbar-right nav_right_on_mobile">                     <li><a href="/web/index.html">首页</a></li>                     <li><a href="/web/product_list.html">全部产品</a></li>                     <li><a href="/web/newhelp.html">新手指引</a></li>                     <li><a href="/web/safety.html">安全保障</a></li>                     <li><a href="/web/about.html">关于美信</a></li> <!--                    <li style="float: right;">                         <a class="btn btn-min-width-sm" href="/logout">退出</a>                     </li>                     <li style="float: right;">                         <a class="btn btn-min-width"                            href="/investor/dashboard">我的账户<#if anxin1_interest_flag=="1"><span class="red_dot"></span></#if></a>                     </li>-->                     <li style="float: right;"><a class="login_no_margin_right nav_login_button" href="/login">登录</a></li>                     <li style="float: right;"><a href="/signup"                            class="hidden-xs nav_register_button">注册</a></li>                     <!--<li style="float: right;"><a href="/signup"                            class="visible-xs">注册</a></li>-->                  </ul>             </div>         </div>     </div> </nav> <style>     @media screen and (max-width: 768px){         .customerPage{             margin-top: 90px;         }         .navbar-fixed-top{             padding: 0!important;         }         #wrapper.customer nav .navbar .container{             padding-top: 0!important;             padding-bottom: 0!important;         }         .nav_right_on_mobile{             width: 100%;         }     } </style> <style>     @media screen and (max-width: 768px){         .navbar-fixed-top{             padding: 0!important;         }         .navbar-fixed-top .container{             padding-top: 0!important;             padding-bottom: 0!important;         }         .navbar-fixed-top{             position: fixed;         }     } </style>
    <div class="container-fluid">
        <section class="text-center" style="margin-top: 70px;">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="fa-steps-bullets international-bullets-extra-styles">
                        <div><p class="active"><span>1</span></p>上传身份证件</div>
                        <div><p><span>2</span></p>投资人基本信息</div>
                        <div><p><span>3</span></p>家庭住址</div>
                        <div><p><span>4</span></p>确认投资</div>
                        <hr/>
                        <span class="clearfix"></span>
                    </div>
                    <form class="fa-steps col-sm-10 col-sm-offset-1" data-parsley-validate>
                        <div class="step-section">
                            <p>根据美国监管要求，国际投资人需要上传身份证件以核实投资者身份信息。</p>
                            <p>您需要上传您的身份证扫描（或照片）以及护照信息页扫描件（或照片）。如果您没有护照，可以只选择上传身份证扫描（或照片）</p>
                            <div class="fa-upload-id-pic fa-upload-pic col-sm-5">
                                <a class="btn btn-primary">上传身份证照片</a>

                                <img src="/version1.0/meixin_invest/img/fa_invest/fa_id_placeholder_650x396.png" alt="">
                                <p>要求：请上传正面照片，字迹清晰，四边完整</p>
                                <input id="id_card_photo" name="id_card_photo" type="file" required=""
                                       data-parsley-required-message="请上传身份证照片！"/>

                            </div>
                            <div class="fa-upload-passport-pic fa-upload-pic col-sm-5 col-sm-offset-2">
                                <a class="btn btn-primary">上传护照照片</a>
                                <img src="/version1.0/meixin_invest/img/fa_invest/fa_passport_placeholder_650x396.png">
                                <p>要求：请上传护照首页照片，字迹清晰，四边完整</p>
                                <input id="passport_photo" name="passport_photo" type="file"/>
                            </div>
                            <span class="clearfix"></span>
                        </div>

                        <div class="step-navigation">
                            <button type="button" class="next btn btn-primary pull-right" id="submit_step_one">下一步</button>
                            <span class="clearfix"></span>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>
<#include "includes/footer.html" />
<link rel="shortcut icon" type="image/png" href="/version1.0/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="/version1.0/vendor/css/font-awesome.min.css">
<script src="/version1.0/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="/version1.0/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/version1.0/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('#wechat-popover').popover({
            html: true,
            placement: 'bottom',
            trigger: 'hover',
            content: '<img style="width: 200px;padding:0;margin:0;" src="/version1.0/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>
<script src="/version1.0/dist/meixin_invest/js/bootstrap-formhelpers.min.js"></script>
<script src="/version1.0/dist/meixin_invest/js/bootstrap-formhelpers-states.min.js"></script>
<script src="/version1.0/dist/meixin_invest/js/bootstrap-formhelpers-countries-nousa.zh_CN.min.js"></script>
<script src="/version1.0/meixin_invest/js/parsley.min.js"></script>
<script src="/version1.0/dist/meixin_invest/js/fa_invest_general.min.js"></script>
<script src="/version1.0/dist/meixin_invest/js/fa.min.js"></script>
<script>
    $(function () {
        //验证登录
        Ajax_Data({
            "url": baseUrl + "/auth/authentication",
            "data": cookie_tooken,
            "fn": is_login,
            "no_login": no_login
        });
        function no_login() {
            window.location = '/login';
        }

        //is_login  调取登录接口
        function is_login(res) {
            $('.navbar ul li:last-child').html('<a class="btn btn-min-width" href="/web/investor/dashboard">我的账户</a>');
            $('.navbar ul li:nth-last-child(2)').html('<a class="btn btn-min-width-sm" href="/logout">退出</a>');
            $('.ajax_wait p,.ajax_wait').hide();

            // 获取profile信息
            var get_profile_data = {
                "fields": "id_card_photo,passport_photo"
            };
            get_profile_data = $.extend({}, get_profile_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/profile/get",
                "data": get_profile_data,
                "fn": get_profile
            });

            // 上传证件图片
            $('.fa-upload-pic input').each(function () {
                var $this = $(this);
                $this.change(function (event) {
                    var val = $this.val().toLowerCase();
                    var regex = new RegExp("(.*?)\.(jpg|jpeg|png|gif|bmp)$");
                    if (!(regex.test(val))) {
                        $this.val('');
                        alert('图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)');

                    } else {
                        file_upload($this);
                        $this.siblings('img').attr('src', URL.createObjectURL(event.target.files[0]));
                    }
                });
            });
            $('#submit_step_one').on('click', function () {
                if (!default_id_card_photo) {
                    $('#id_card_photo').prop("required", false);
                }
                if ($('.fa-steps').parsley().validate()) {
                    $('.ajax_wait').show();
                    setTimeout(function () {
                        $('.ajax_wait p').show();
                    }, 3e3);// 创建订单
                    if (is_new) {
                        var create_order_data = {
                            "product_id": product_id,
                            "invest_amount": product_invest_amount
                        };
                        create_order_data = $.extend({}, create_order_data, cookie_tooken);
                        Ajax_Data({
                            "type": "post",
                            "url": baseUrl + "/order/create",
                            "data": create_order_data,
                            "fn": create_order_res,
                            "fail_fn": create_order_fail
                        });
                    }
                    if (is_old) {
                        order_number = getUrlParam("order_number");
                        var img_src = $('#id_card_photo').siblings('img').attr('src');
                        var passport_photo_img = $('#passport_photo').siblings('img').attr('src');
                        //上传profile信息
                        var update_profile_data = {};
                        if (default_id_card_photo) {
                            update_profile_data.id_card_photo = id_card_photo;
                        } else {
                            update_profile_data.id_card_photo = img_src;
                        }
                        if (default_passport_photo) {
                            update_profile_data.passport_photo = passport_photo;
                        } else {
                            update_profile_data.passport_photo = passport_photo_img;
                        }
                        update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
                        Ajax_Data({
                            "type": "post",
                            "url": baseUrl + "/profile/update",
                            "data": update_profile_data,
                            "fn": update_profile,
                            "fail_fn": update_profile_fail
                        });
                    }
                    return false;
                }
            })
        }

        //获取profile信息
        function get_profile(d) {
            if (d.id_card_photo != "" && d.id_card_photo != null) {
                $('#id_card_photo').siblings('img').attr('src', d.id_card_photo);
                $('#id_card_photo').siblings('p').html('您已上传的身份证照片');
                $('#id_card_photo').prop("required", false);
                default_id_card_photo = false;
            }
            if (d.passport_photo != "" && d.passport_photo != null) {
                $('#passport_photo').siblings('img').attr('src', d.passport_photo);
                $('#passport_photo').siblings('p').html('您已上传的护照照片');
                default_passport_photo = false;
            }
        }

        // 创建订单
        function create_order_res(res) {
            order_number = res;
            var img_src = $('#id_card_photo').siblings('img').attr('src');
            var passport_photo_img = $('#passport_photo').siblings('img').attr('src');
            //上传profile信息
            var update_profile_data = {};
            if (default_id_card_photo) {
                update_profile_data.id_card_photo = id_card_photo;
            } else {
                update_profile_data.id_card_photo = img_src;
            }
            if (default_passport_photo) {
                update_profile_data.passport_photo = passport_photo;
            } else {
                update_profile_data.passport_photo = passport_photo_img;
            }
            update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
            Ajax_Data({
                "type": "post",
                "url": baseUrl + "/profile/update",
                "data": update_profile_data,
                "fn": update_profile,
                "fail_fn": update_profile_fail
            });
        }

        //更新profile信息
        function update_profile(res) {
            $('.ajax_wait p,.ajax_wait').hide();
//            window.location.href = "/fa_invest/international/form_step_2.html?order_number=" + order_number;
            window.location.href = "/glacier-static/src/main/webapp/WEB-INF/template/fa_invest/international/form_step_2.html?order_number=" + order_number;
        }


        function file_upload(id) {
            var formData = new FormData($('form')[0]);
            formData.append('file', id[0].files[0]);
            formData.append('mx_token', mx_token);
            formData.append('mx_secret', mx_secret);
            $.ajax({
                url: baseUrl + '/upload/user_file',
                dataType: 'json',
                type: 'post',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (result, status) {
                    if (result.code == 1) {
                        if (event.target.id == 'id_card_photo') {
                            id_card_photo = result.body;
                            id.siblings('p').html('您已上传的身份证照片');
                        }
                        if (event.target.id == 'passport_photo') {
                            passport_photo = result.body;
                            id.siblings('p').html('您已上传的护照照片');
                        }
                    }
                    if (result.code == -1) {
                        alert("上传失败,请重新上传");
                    }
                }
            });
        }
    })
</script>
</body>
</html>