<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>
        美信金融|更新密码
    </title>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/is_ok.min.js"></script>
    <link rel="stylesheet" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/css/bootstrap.min.css">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/base.min.css" rel="stylesheet">

    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <script type='text/javascript'>window.BWEUM||(BWEUM={});BWEUM.info =
    {"stand":true,"agentType":"browser","agent":"//bi-collector.oneapm.comhttp://dev-investor-upload.oss-cn-beijing.aliyuncs.comhttp://dev-investor-upload.oss-cn-beijing.aliyuncs.com/static/version_1.1/js/bw-send-411.4.5.js","beaconUrl":"bi-collector.oneapm.com/beacon","licenseKey":"VRQIr~Vf3JaYiJQI","applicationID":2280029};</script><script type="text/javascript" src="//bi-collector.oneapm.comhttp://dev-investor-upload.oss-cn-beijing.aliyuncs.comhttp://dev-investor-upload.oss-cn-beijing.aliyuncs.com/static/version_1.1/js/bw-loader-411.4.5.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-66578252-1', 'auto');
        ga('send', 'pageview');
    </script>
    <!--[if lt IE 9]>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/html5shiv"></script>
    <script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div id="wrapper" class="customer">
    @@include('../includes/header.html')
    <div class="customerPage">

        <div id="customerChilantro">
            <div id="content" class="container">

                <div class="row">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-12 col-sm-5 col-sm-offset-4 form-box">

                                <div class="wrapper project-wrapper container-fluid">
                                    <h5 id="form-title" style="margin-top: 20px">更新密码</h5>
                                    <hr/>
                                    <div id="error-place" style="height: 51px; margin-bottom: 20px;"></div>
                                        <form id="form">
                                            <input type="hidden" name="email" value="${email}">
                                            <input type="hidden" name="token" value="${token}">
                                            新密码 <input class="form-control" id="new_password1" name="new_password1" size="50" type="password" value="">
                                            <br/>

                                            确认密码
                                            <input class="form-control" id="new_password2" name="new_password2" size="50" type="password" value="">

                                            <div class="form-actions  text-center">

                                                <button id="update-button" class="btn btn-default" type="submit" style="margin-top: 30px">更新密码</button>

                                            </div>
                                        </form>
                                    <br/>
                                    <br/>
                                    <br/>
                                    <br/>
                                    <br/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@@include('../includes/footer.html')
<link rel="shortcut icon" type="image/png" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/css/font-awesome.min.css">
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/jquery.cookie.min.js" type="text/javascript" ></script>
<script src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(".form-control").on("focus",function () {
        $(".form-control").css("border-color","#D4D4E9");
        $("#text").remove();
    })
</script>
<script>
    //获取url中的参数
    var source=getUrlParam('source');
    $.cookie('source',source,{expires: 30});
</script>
<script>
    $(document).ready(function(){
        $('#wechat-popover').popover({
            html: true,
            placement: 'bottom',
            trigger: 'hover',
            content: '<img style="width: 200px;padding:0;margin:0;" src=""http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });

        $('#update-button').click(function () {
            var new_password1 = $('#new_password1').val();
            var new_password2 = $('#new_password2').val();
            if(getUrlParam('user_name') != '' && getUrlParam('user_name') != null && getUrlParam('verify_code') != '' && getUrlParam('verify_code') != null)
            {
                var phoneData ={};
                phoneData.password = $.trim($('#new_password1').val());
                phoneData.user_name = $.trim(getUrlParam('user_name'));
                phoneData.verify_code = $.trim(getUrlParam('verify_code'));
                if(new_password1==''){
                    $("#new_password1").css("border-color","#ff0000");
                }
                if(new_password1.length<6){
                    $("#error-place").html("<div id='text' style='text-align: center;' class='alert alert-warning'>" + '请输入不少于6位的新密码' +"</div>");
                }
                if(new_password2==''){
                    $("#new_password2").css("border-color","#ff0000");
                }
                if(new_password2 != new_password1){
                    $("#new_password2").css("border-color","#ff0000");
                    $("#error-place").html("<div id='text' style='text-align: center;' class='alert alert-warning'>" + '确认密码与新密码不一致' +"</div>");
                }
                if(new_password1 != '' && new_password2 != ''){
                    $.ajax({
                        type:'post',
                        url: baseUrl + '/auth/reset_password',
                        data: phoneData,
                        success: function (res) {
                            if (res.code == 1) {
                                $("#form").remove();
                                $('#error-place').append("<p style=' text-align: center;'>" + '密码已重新设置' + "<br/>"
                                        + "<a href= '/login.html' class='btn btn-success btn-block' type='submit' style='margin-top: 20px'>" + '登录'+ "</a>" +"</p>");
                            } else if (res.code != 1) {
                                $("#error-place").html("<div style='text-align: center;' class='alert alert-warning'>" + res.msg +"</div>");
                            }
                        }
                    });
                }
                return false;
            }

            if(getUrlParam('email').indexOf('@') > 0 && getUrlParam('token') != '' && getUrlParam('token') != null){
                var emailData ={};
                emailData.password = $.trim($('#new_password1').val());
                emailData.user_name = $.trim(getUrlParam('email'));
                emailData.verify_code = $.trim(getUrlParam('token'));
                if(new_password1==''){
                    $("#new_password1").css("border-color","#ff0000");
                }
                if(new_password1.length<6){
                    $("#error-place").html("<div id='text' style='text-align: center;' class='alert alert-warning'>" + '请输入不少于6位的新密码' +"</div>");
                }
                if(new_password2==''){
                    $("#new_password2").css("border-color","#ff0000");
                }
                if(new_password2 != new_password1){
                    $("#new_password2").css("border-color","#ff0000");
                    $("#error-place").html("<div id='text' style='text-align: center;' class='alert alert-warning'>" + '确认密码与新密码不一致' +"</div>");
                }
                if(new_password1 != '' && new_password2 != ''){
                    $.ajax({
                        type:'post',
                        url: baseUrl + '/auth/reset_password',
                        data: emailData,
                        success: function (res) {
                            if (res.code == 1) {
                                $("#form").remove();
                                $('#error-place').append("<p style=' text-align: center;'>" + '密码已重新设置' + "<br/>"
                                        + "<a href= '/login.html' class='btn btn-success btn-block' type='submit' style='margin-top: 20px'>" + '登录'+ "</a>" +"</p>");
                            } else if (res.code != 1) {
                                $("#error-place").html("<div style='text-align: center;' class='alert alert-warning'>" + res.msg +"</div>");
                            }
                        }
                    });
                }

                return false;
            }
            return false;
        });
    });
</script>
<script type="text/javascript" src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/vendor/js/pwstrength-bootstrap-1.2.9.min.js"></script>
<script type="text/javascript" src="http://bj-dev-static.oss-cn-beijing.aliyuncs.com/static/version_1.1/dist/meixin_invest/js/password-reset-confirm.min.js"></script>
</body>
</html>