<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融|投资流程
    </title>
    <script src="/static/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/static/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script>
        var token = $.cookie('mx_sid');
        if(!token){
            //window.location = 'https://www.meixinfinance.com';
        }
        $.ajax({
            type: 'get',
            url: 'http://101.201.112.171:8082/apiv2/is_login',
            data: null,
            success: function (data) {
                if (data && data.code && data.code == -1) {
                    //window.location = 'https://www.meixinfinance.com';
                }
            }
        });
    </script>
    <link rel="stylesheet" href="/static/vendor/css/bootstrap.min.css">
    <link href="/static/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="/static/meixin_invest/css/fa_invest.css" rel="stylesheet">
    <link href="/static/meixin_invest/css/agreement-forms.css" rel="stylesheet">
    <#include "includes/oneapm.html" />
    <#include "includes/ga.html" />
    <script>
        var _hmt = _hmt || [];
        (function()
                { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); }
        )();
    </script>
    <!--[if lt IE 9]>
    <script src="/static/vendor/js/html5shiv"></script>
    <script src="/static/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div id="wrapper" class="customer">
    <#include "includes/navbar.html" />
    <div class="container-fluid">
        <section class="text-center" style="margin-top: 70px;">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="fa-steps-bullets international-bullets-extra-styles yellow-bullets-point">
                        <div style="width:19%"><p><span>1</span></p>个人信息</div>
                        <div><p><span>2</span></p>合规信息</div>
                        <div><p class="active"><span>3</span></p>护照证件上传</div>
                        <div><p><span>4</span></p>地址证明上传</div>
                        <div><p><span>5</span></p>签字确认</div>
                        <hr/>
                        <span class="clearfix"></span>
                    </div>
                    <form class="fa-steps col-sm-10 col-sm-offset-1" data-parsley-validate>
                        <div class="step-section">
                            <p>根据监管要求, 投资人需要上传护照证件及地址证明以核实投资者身份信息。</p>
                            <div class="fa-upload-id-pic fa-upload-pic col-sm-5">
                                <a class="btn btn-primary">点击上传护照证件</a>
                                <img src="/static/meixin_invest/img/upload_id_placeholder_518x348.png">
                                <input id="identity-proof" name="identity-proof" type="file"
                                       data-parsley-required-message="请上传护照证件照片！" required/>
                            </div>
                            <div class="fa-upload-passport-pic fa-upload-pic col-sm-5 col-sm-offset-2">
                                <p>请在以下证件类型中选择一项进行上传</p>
                                <p>符合要求的护照证件包括:</p>
                                <p>有效的护照信息页(包括签名)</p>
                                <p>注意: 如果您的护照证件(例如:旧版中国护照)不包含签名部分,请将证件置于白纸之上, 并于证件下方签名, 牌照或扫描上传。证件必须为原件, 不能为复印件。</p>
                            </div>
                            <span class="clearfix"></span>
                        </div>

                        <div class="step-navigation">
                            <button type="button" class="previous btn btn-primary pull-left">返回</button>

                            <button type="fasubmit" id="submit_step_three" class="btn btn-primary pull-right"><span
                                    class="glyphicon glyphicon-refresh spinning"
                                    style="display: none;"></span><span>下一步</span></button>
                            <span class="clearfix"></span>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>
<link rel="shortcut icon" type="image/png" href="/static/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="/static/vendor/css/font-awesome.min.css">
<script src="/static/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="/static/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function(){
        $('#wechat-popover').popover({
            html : true,
            placement : 'bottom',
            trigger : 'hover',
            content : '<img style="width: 200px;padding:0;margin:0;" src="/static/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-yellowstone.min.js" type="text/javascript"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-countries.zh_CN.min.js"
        type="text/javascript"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-phone.min.js" type="text/javascript"></script>
<script src="/static/meixin_invest/js/parsley.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa_invest_general.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa.min.js"></script>
<script>
    var data={};
    data.country=$('#resident-countries-states').val();
    function $_GET(param) {
        var vars = {};
        window.location.href.replace( location.hash, '' ).replace(
                /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
                function( m, key, value ) { // callback
                    vars[key] = value !== undefined ? value : '';
                }
        );

        if ( param ) {
            return vars[param] ? vars[param] : null;
        }
        return vars;
    }
    var identity_proof_url;
    // Meixin Indentification Proof Api Call
    function saveIdentityProofToInvestDb() {
        var formData = new FormData(this);
        if ($('#identity-proof').get(0).files.length != 0) {
            formData.append('identity_proof', $("#identity-proof")[0].files[0]);
        }
        $.ajax({
            url: '/apiv2/order/upload/identity_proof',
            dataType: 'json',
            method: 'post',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success: function (result, status) {
                console.log(result);
                console.log('meixin id proof save success');
                identity_proof_url = result.idenOrAddressName;
                yellowStepThree();
            },
            error: function (response) {
                console.log(response);
                is_success = false;
                error = "身份证明上传有误";
            },
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('access_token'));
            }
        });
    }
    //yellow stop3 submit(更新护照信息)
    function yellowStepThree() {
        var entity_id = $("#step_three_entity_id").val();
        $.ajax({
            url: '/apiv2/order/update/otherInfo',
            dataType: 'json',
            method: 'POST',
            async: false,
            data: {
                "entity_id": entity_id,
                "identity_proof_url":identity_proof_url
            },
            success: function (result, status) {
                console.log("update fa passart entity ");
                location.href = "/api/yellowstone/to_create_signature?entity_id=" + entity_id;
            },
            error: function (response) {
                console.log(response);
                is_success = false;
                error = "投资人护照信息填写有误";
                error_detail = response.responseText;
                console.log(error_detail);
            },
            beforeSend: function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('access_token'));
            }
        });
    }

    // handle submission
    $('#submit_step_three').click(function () {
        if ($('.fa-steps').parsley().validate({group: 'block-' + curIndex()})) {
            $('#submit_step_three').attr("disabled", "disabled");
            $('#submit_step_three span').eq(0).show();
            $('#submit_step_three span').eq(1).text(" 提交中...");
            setTimeout(function () {
                //第一步,保持上传信息
                if (is_success == true) {
                    saveIdentityProofToInvestDb();
                }
            }, 500);
        }
    });
</script>
</body>
</html>
