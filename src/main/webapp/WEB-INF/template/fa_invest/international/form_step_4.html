<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融|投资流程
    </title>
    <script src="/static/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/static/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script src="/static/meixin_invest/js/is_ok.js"></script>
    <link rel="stylesheet" href="/static/vendor/css/bootstrap.min.css">
    <link href="/static/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/fa_invest.min.css" rel="stylesheet">
    <#include "includes/oneapm.html" />
    <#include "includes/ga.html" />
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <!--[if lt IE 9]>
    <script src="/static/vendor/js/html5shiv"></script>
    <script src="/static/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="ajax_wait">
    <div class="ajax_wait_gif"><img src="/static/dist/meixin_invest/img/Unknown.gif" alt=""></div>
    <p>哎吆喂！网速似乎有点慢，点击这里<a href="/index.html">跳回首页!</a></p>
</div>
<script>
    setHeight();
    $(window).resize(function () {
        setHeight();
    });
</script>
<div id="wrapper" class="customer">
    <#include "includes/navbar.html" />
    <div class="container-fluid">
        <section class="text-center" style="margin-top: 70px;">
            <div class="row">
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="fa-steps-bullets international-bullets-extra-styles">
                        <div><p><span>1</span></p>上传身份证件</div>
                        <div><p><span>2</span></p>投资人基本信息</div>
                        <div><p><span>3</span></p>家庭住址</div>
                        <div><p class="active"><span>4</span></p>确认投资</div>
                        <hr/>
                        <span class="clearfix"></span>
                    </div>
                    <form class="fa-steps col-sm-10 col-sm-offset-1" data-parsley-validate>

                        <div class="step-section payment-section text-left radio-custom label-left">
                            <label>投资金额：</label>
                            <input data-parsley-pattern="/^([1-9][0-9]{0,1}0000)$|^([1-9][0-9]{0,1}[5]000)$/"
                                   data-parsley-pattern-message="最低投资金额：$10,000，必须为5000的倍数" id="invest-amount"
                                   name="invest-amount"
                                   class="form-control"
                                   placeholder="最低投资金额：$10,000，必须为5000的倍数" required=""
                                   onkeypress="return event.charCode === 0 || /\d/.test(String.fromCharCode(event.charCode));"/>
                            <section>
                                <label>投资方式：</label>
                                <div class="payment-option">
                                    <input type="radio" name="payment" id="ach-online" payment-method="ach"
                                           required="" data-parsley-required-message="请选择支付方式"/>
                                    <label for="ach-online"><span><span></span></span>ACH在线自动转账（最方便、需要美国银行账户、账户姓名需与投资人姓名一致）</label><br>
                                    <input type="radio" name="payment" id="bank-tt" payment-method="wire"/>
                                    <label for="bank-tt"><span><span></span></span>银行电汇（从非美国银行账户）</label><br>

                                    <input type="radio" name="payment" id="check" payment-method="check"/>
                                    <label for="check"><span><span></span></span>支票</label>
                                </div>
                            </section>
                            <div class="ach-online-box">
                                <label><img src="/static/meixin_invest/img/fa_invest/fa_pay_name_60x58.png"/></label>
                                <input id="bank-account-name" class="form-control" placeholder="Name On Account"/>
                                <label><img
                                        src="/static/meixin_invest/img/fa_invest/fa_pay_routing_60x54.png"/></label>
                                <input id="routing-number" class="form-control"
                                       placeholder="9 Digit Bank Routing Number"/>
                                <label><img src="/static/meixin_invest/img/fa_invest/fa_pay_account_54x60.png"/></label>
                                <input id="bank-account-number" class="form-control"
                                       placeholder="Bank Account Number"/>
                                <div class="accout-check-type">
                                    <label>Accout Type</label>
                                     <span id="accouttype">
                                     <label for="accoutType-checking"><input type="radio" name="accoutType"
                                                                             id="accoutType-checking"
                                                                             accounttype="checking"/><span>Checking</span></label>
                                     <label for="accoutType-saving"><input type="radio" name="accoutType"
                                                                           id="accoutType-saving"
                                                                           accounttype="savings"/><span>Savings</span></label>
                                     </span>
                                    <label>Check Type</label>
                                     <span id="checktype">
                                     <label for="checkType-personal"><input type="radio" name="checkType"
                                                                            id="checkType-personal"
                                                                            checktype="personal"/><span>Personal</span></label>
                                     <label for="checkType-business"><input type="radio" name="checkType"
                                                                            id="checkType-business"
                                                                            checktype="business"/><span>Business</span></label>
                                     </span>
                                </div>
                                <div class="agreement"></div>
                                <!--<input type="checkbox" name="agreement" id="achAgreement"/>
                                <label for="achAgreement"><span><span></span></span>我已认真阅读并接受<a
                                        href="/static/meixin_invest/doc/ACH-AUTHORIZATION-AGREEMENT.pdf"
                                        target="blank">《ACH AUTHORIZATION
                                    AGREEMENT》</a></label><br>
                                <input type="checkbox" name="agreement" id="agreement-01"/>
                                <label for="agreement-01"><span><span></span></span>我已认真阅读并接受<a
                                        href="/static/meixin_invest/doc/${product.subscription_agreement_name}"
                                        target="blank">《认购协议》</a></label>-->
                                <div class="sign-name">
                                    <label>签名：</label>
                                    <input id="ach-signature" class="form-control literal" placeholder="请输入您的名字与姓的拼音以确认"
                                           name="signature"/>
                                </div>
                            </div>
                            <div class="bank-tt-box">
                                <p><span>汇款信息：</span></p>
                                <p><span>备注栏请填写：</span>

                                    YOUR NAME & ${product.external_name}

                                </p>
                                <p><span>收款人名字：</span>Fund America Securities, LLC</p>
                                <p><span>收款人地址：</span>3455 Peachtree Road, NE 5th Floor Atlanta, GA 30326</p>
                                <p><span>账户号Account #：</span>0001476100</p>
                                <p><span>收款路径号ABA/Routing #：</span>122242869</p>
                                <p><span>Swift Code：</span>PMERU66</p>
                                <p><span>收款银行：</span>Pacific Mercantile Bank</p>
                                <p><span>收款银行地址：</span>949 South Coast Drive, Third Floor Costa Mesa, CA 92626,
                                    (714)438-2500</p>
                                <p><span>注意：请您在接收到我们邮件通知您投资人身份审核通过后再前往银行进行汇款</span></p>
                                <div class="agreement"></div>
                                <!--<input type="radio" name="agreement" id="agreement-02"
                                       data-parsley-required-message="请阅读并接受认购协议"/>

                                <label for="agreement-02"><span><span></span></span>我已认真阅读并接受<a
                                        href="/static/meixin_invest/doc/${product.subscription_agreement_name}"
                                        target="blank">《认购协议》</a></label>-->
                                <div class="sign-name">
                                    <label>签名：</label>
                                    <input id="wire-signature" class="form-control literal"
                                           placeholder="请输入您的名字与姓的拼音以确认">
                                </div>
                            </div>
                            <div class="check-box">
                                <p><span>收款人：</span>FUNDAMERICA SECURITIES</p>
                                <p><span>备注栏请填写：</span>
                                    YOUR NAME ${product.external_name}
                                </p>
                                <p><span>请将支票寄至以下地址：</span></p>
                                <p>FundAmerica Securities</p>
                                <p>3455 Peachtree Road, NE</p>
                                <p>5th Floor</p>
                                <p>Atlanta, GA 30326</p>
                                <p><span>注意：我们目前只接受来自美国银行账户的支票</span></p>
                                <div class="agreement"></div>
                                <!--<input type="radio" name="agreement" id="agreement-03"
                                       data-parsley-required-message="请阅读并接受认购协议"/>
                                <label for="agreement-03"><span><span></span></span>我已认真阅读并接受<a
                                        href="/static/meixin_invest/doc/${product.subscription_agreement_name}"
                                        target="blank">《认购协议》</a></label>-->
                                <div class="sign-name">
                                    <label>签名：</label>
                                    <input id="check-signature" class="form-control literal"
                                           placeholder="请输入您的名字与姓的拼音以确认">
                                </div>
                            </div>
                        </div>

                        <div class="step-navigation">
                            <button type="button" class="previous btn btn-primary pull-left">返回</button>
                            <button type="button" id="submit_step_four" class="btn btn-primary pull-right"><span
                                    class="glyphicon glyphicon-refresh spinning"
                                    style="display: none;"></span><span>提交</span></button>
                            <span class="clearfix"></span>
                        </div>
                    </form>

                </div>
            </div>
        </section>
    </div>
</div>
<#include "includes/footer.html" />
<link rel="shortcut icon" type="image/png" href="/static/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="/static/vendor/css/font-awesome.min.css">
<script src="/static/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="/static/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $('#wechat-popover').popover({
            html: true,
            placement: 'bottom',
            trigger: 'hover',
            content: '<img style="width: 200px;padding:0;margin:0;" src="/static/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers.min.js"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-states.min.js"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-countries-nousa.zh_CN.min.js"></script>
<script src="/static/meixin_invest/js/parsley.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa_invest_general.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa.min.js"></script>
<script>
    $(function () {
        Ajax_Data({
            "url": baseUrl + "/auth/authentication",
            "data": cookie_tooken,
            "fn": is_login,
            "no_login": no_login
        });
        function no_login() {
            window.location = '/login';
        }

        //is_login  调取登录接口
        function is_login(res) {
            $('.navbar ul li:last-child').html('<a class="btn btn-min-width" href="/investor/dashboard">我的账户</a>');
            $('.navbar ul li:nth-last-child(2)').html('<a class="btn btn-min-width-sm" href="/logout">退出</a>');
            $('.ajax_wait p,.ajax_wait').hide();


            // 获取投资金额
            var get_invest_data = {};
            get_invest_data.order_number = order_number;
            get_invest_data = $.extend({}, get_invest_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/order/" + order_number,
                "data": get_invest_data,
                "fn": invest_data
            });
            // 获取bank信息
            var get_bank_data = cookie_tooken;
            Ajax_Data({
                "url": baseUrl + "/profile/bank/get",
                "data": get_bank_data,
                "fn": get_bank_profile
            });
            //获取文档信息
            var index = $('.payment-option>input:checked').index() / 3;      // 获取投资方式选中的索引值
            var product_document_data = {"product_id": 8};
            product_document_data = $.extend({}, product_document_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/product_document/get",
                "data": product_document_data,
                "fn": product_document
            });
            function product_document(res) {
                var div = $('<div id="agreements-preview"></div>');
                $.each(res, function (key) {
                    switch (res[key].need_check) {
                        case true:
                            div.append('<div><input type="checkbox" id="doc_' + res[key].id + '" name=' + res[key].document_name + ' required="" data-parsley-required-message="请填写信息"/><label for="#doc_' + res[key].id + '"><span><span class="invest-check-mark"></span></span>我已认真阅读并接受<a href=' + res[key].url + ' class="get_pdf" data-document-id=' + res[key].id + '>《' + res[key].document_name + '》</a></label><br></div>');
                            break;
                        case false:
                            div.append('<div><a href=' + res[key].url + ' target="_blank">' + res[key].document_name + '</a><br></div>');
                            break;
                    }
                });
                var not_ach_doc = div.clone();
                not_ach_doc.children().first().remove();
                var check_box=not_ach_doc.clone();
                $('.ach-online-box .agreement').append(div);
                $('.bank-tt-box .agreement').append(not_ach_doc);
                $('.check-box .agreement').append(check_box);
                $('#agreements-preview').find('a.get_pdf').on('click', function () {
                    var result = "";
                    var $this = $(this);
                    var populate_data = {};
                    populate_data.document_id = $(this).attr('data-document-id');
                    populate_data.invest_amount = $('#invest-amount').val();
                    populate_data = $.extend({}, populate_data, cookie_tooken);
                    Ajax_Data({
                        "url": baseUrl + "/product_document/populate",
                        "data": populate_data,
                        "async": false,
                        "fn": populate
                    });
                    function populate(res) {
                        result = res;
                    }

                    if (result.length > 0) {
                        window.open(result, "_blank");
                    }
                    return false;
                });
            }

            //获取profile信息
            var get_profile_data = {
                "fields": "literal"
            };
            get_profile_data = $.extend({}, get_profile_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/profile/get",
                "data": get_profile_data,
                "fn": get_profile
            });

            $('#submit_step_four').on('click', function () {
                if ($('.fa-steps').parsley().validate()) {
                    $('.ajax_wait').show();
                    setTimeout(function () {
                        $('.ajax_wait p').show();
                    }, 3e3);
                    order_number = getUrlParam("order_number");
                    //上传bank信息
                    if (index == 0) {
                        var update_bank_data = {};
                        update_bank_data.account_number = $('#bank-account-number').val();
                        update_bank_data.account_name = $('#bank-account-name').val();
                        update_bank_data.routing_number = $('#bank-routing-number').val();
                        update_bank_data.ach_account_type = $('#accouttype input:checked').attr('accounttype');
                        update_bank_data.ach_check_type = $('#checktype input:checked').attr('checktype');
                        update_bank_data = $.extend({}, update_bank_data, cookie_tooken);
                        Ajax_Data({
                            "type": "post",
                            "url": baseUrl + "/profile/bank/update",
                            "data": update_bank_data,
                            "fn": update_bank_profile,
                            "fail_fn": update_bank_fail
                        });
                    }


                    //上传profile信息
                    var update_profile_data = {};
                    update_profile_data.literal = $('.literal').eq(index).val();
                    update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
                    Ajax_Data({
                        "type": "post",
                        "url": baseUrl + "/profile/update",
                        "data": update_profile_data,
                        "fn": update_profile,
                        "fail_fn": update_profile_fail
                    });

                    // 提交订单
                    var order_commit_data = {};
                    order_commit_data.invest_amount = $('#invest-amount').val();
                    order_commit_data.order_number = order_number;
                    order_commit_data = $.extend({}, order_commit_data, cookie_tooken);
                    Ajax_Data({
                        "type": "post",
                        "url": baseUrl + "/order/commit",
                        "data": order_commit_data,
                        "fn": commit_order,
                        "fail_fn": commit_order_fail
                    });
                    return false;
                }
            })
        }

        // 获取用户投资金额
        function invest_data(d) {
            if (d.invest_amount != '' && d.invest_amount != null) {
                $('#invest-amount').val(d.invest_amount);
            }
        }

        //获取bank信息
        function get_bank_profile(d) {
            if (d.account_number != "" && d.account_number != null) {
                $('#bank-account-number').val(d.account_number);
            }
            if (d.account_name != "" && d.account_name != null) {
                $('#bank-account-name').val(d.account_name);
            }
            if (d.routing_number != "" && d.routing_number != null) {
                $('#bank-routing-number').val(d.routing_number);
            }
            if (d.ach_account_type != '' && d.ach_account_type != null) {
                var accoutType = $('#accouttype').find('span');
                accoutType.each(function (index) {
                    if (accoutType[index].text().toLowerCase() == d.ach_account_type) {
                        accoutType[index].siblings('input').attr('checked', true);
                    }
                });
            }
            if (d.ach_check_type != '' && d.ach_check_type != null) {
                var checkType = $('#checktype').find('span');
                checkType.each(function (index) {
                    if (checkType[index].text().toLowerCase() == d.ach_check_type) {
                        checkType[index].siblings('input').attr('checked', true);
                    }
                });
            }
        }

        // 获取profile信息
        function get_profile(d) {
            if (d.literal != '' && d.literal != null) {
                $('.literal').val(d.literal);
            }
        }

        //提交bank信息
        function update_bank_profile() {
            console.log('开户银行信息提交成功');
        }

        //更新profile信息
        function update_profile(res) {
            console.log('信息提交成功');
        }

        // 提交订单
        function commit_order() {
            window.location = "/glacier-static/src/main/webapp/WEB-INF/template/fa_invest/form_success.html";
        }
    })
</script>
</body>
</html>