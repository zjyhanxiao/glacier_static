<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <title>
        美信金融|投资流程
    </title>
    <script src="/static/vendor/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="/static/dist/meixin_invest/js/jquery.cookie.min.js"></script>
    <script src="/static/meixin_invest/js/is_ok.js"></script>
    <link rel="stylesheet" href="/static/vendor/css/bootstrap.min.css">
    <link href="/static/dist/meixin_invest/css/base.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/detail-new.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/index.min.css" rel="stylesheet">
    <link href="/static/dist/meixin_invest/css/fa_invest.min.css" rel="stylesheet">
    <#include "includes/oneapm.html" />
    <#include "includes/ga.html" />
    <script>
    var _hmt = _hmt || [];
    (function()
    { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?36100da860ed74085d2bdd67bdbdbf5e"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); }
    )();
    </script>
    <!--[if lt IE 9]>
    <script src="/static/vendor/js/html5shiv"></script>
    <script src="/static/vendor/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="ajax_wait">
    <div class="ajax_wait_gif"><img src="/static/dist/meixin_invest/img/Unknown.gif" alt=""></div>
    <p>哎吆喂！网速似乎有点慢，点击这里<a href="/index.html">跳回首页!</a></p>
</div>
<script>
    setHeight();
    $(window).resize(function () {
        setHeight();
    });
</script>
<div id="wrapper" class="customer">
     <#include "includes/navbar.html" />
     <div class="container-fluid">
         <section class="text-center" style="margin-top: 70px;">
             <div class="row">
                 <div class="col-sm-10 col-sm-offset-1">
                     <div class="fa-steps-bullets international-bullets-extra-styles">
                         <div><p><span>1</span></p>上传身份证件</div>
                         <div><p><span>2</span></p>投资人基本信息</div>
                         <div><p class="active"><span>3</span></p>家庭住址</div>
                         <div><p><span>4</span></p>确认投资</div>
                         <hr/>
                         <span class="clearfix"></span>
                     </div>
                     <form class="fa-steps col-sm-10 col-sm-offset-1" data-parsley-validate>
                         <div class="step-section label-left">
                             <p style="color: red;">请填写汉语拼音和阿拉伯数字</p>
                             <label>城市：</label>
                             <input id="city" class="form-control" required=""
                                    placeholder="请填写城市名的拼音，例如”北京市“请填写“Beijing”" onblur="ReplaceDot('city')">
                             <label>街道名：</label>
                             <input id="street" class="form-control" required=""
                                    placeholder="请填写街道名的拼音，例如“人民路”请填写“Renminlu”" onblur="ReplaceDot('street')">
                             <label>门牌号码：</label>
                             <input id="door" class="form-control" required=""
                                    placeholder="请填写街道的门牌号码，例如“人民路1号”请填写“1”" onblur="ReplaceDot('door')">
                             <label>公寓号：</label>
                             <input id="apartment" class="form-control"
                                    placeholder="请填写公寓房间号码，例如“601室”请填写”Room 601“" onblur="ReplaceDot('apartment')">
                             <label>邮政编码：</label>
                             <input id="zipcode" class="form-control" required="" placeholder="请填写准确的邮政编码" onblur="ReplaceDot('zipcode')">
                         </div>

                         <div class="step-navigation">
                             <button type="button" class="previous btn btn-primary pull-left">返回</button>
                             <button type="button" class="next btn btn-primary pull-right" id="submit_step_four">下一步</button>
                             <span class="clearfix"></span>
                         </div>
                     </form>
                 </div>
             </div>
         </section>
     </div>
 </div>
 <#include "includes/footer.html" />
<link rel="shortcut icon" type="image/png" href="/static/dist/meixin_invest/img/favicon.png">
<link rel="stylesheet" href="/static/vendor/css/font-awesome.min.css">
<script src="/static/vendor/js/jquery-ui.min.js" type="text/javascript"></script>
<script src="/static/vendor/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/static/dist/meixin_invest/js/navi.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function(){
        $('#wechat-popover').popover({
            html : true,
            placement : 'bottom',
            trigger : 'hover',
            content : '<img style="width: 200px;padding:0;margin:0;" src="/static/meixin_invest/img/meixin_new_qr_code_300x300.jpg" />'
        });
    });
</script>

<script>
    $(function () {
        Ajax_Data({
            "url": baseUrl + "/auth/authentication",
            "data": cookie_tooken,
            "fn": is_login,
            "no_login": no_login
        });
        function no_login() {
            window.location = '/login';
        }

        //is_login  调取登录接口
        function is_login(res) {
            $('.navbar ul li:last-child').html('<a class="btn btn-min-width" href="/investor/dashboard">我的账户</a>');
            $('.navbar ul li:nth-last-child(2)').html('<a class="btn btn-min-width-sm" href="/logout">退出</a>');
            $('.ajax_wait p,.ajax_wait').hide();


            // 获取profile信息
            var get_profile_data = {
                "fields": "mailing_address_city,mailing_address_street,mailing_address_door,mailing_address_apartment,mailing_address_postal_code"
            };
            get_profile_data = $.extend({}, get_profile_data, cookie_tooken);
            Ajax_Data({
                "url": baseUrl + "/profile/get",
                "data": get_profile_data,
                "fn": get_profile
            });


            $('#submit_step_four').on('click', function () {
                if ($('.fa-steps').parsley().validate()) {
                    $('.ajax_wait').show();
                    setTimeout(function () {
                        $('.ajax_wait p').show();
                    }, 3e3);

                    order_number = getUrlParam("order_number");

                    //上传profile信息
                    var update_profile_data = {};
                    update_profile_data.mailing_address_city = $('#city').val();
                    update_profile_data.mailing_address_street = $('#street').val();
                    update_profile_data.mailing_address_door = $('#door').val();
                    update_profile_data.mailing_address_apartment = $('#apartment').val();
                    update_profile_data.mailing_address_postal_code = $('#zipcode').val();
                    update_profile_data = $.extend({}, update_profile_data, cookie_tooken);
                    Ajax_Data({
                        "type": "post",
                        "url": baseUrl + "/profile/update",
                        "data": update_profile_data,
                        "fn": update_profile,
                        "fail_fn": update_profile_fail
                    });
                    return false;
                }
            });

            //获取profile信息
            function get_profile(d) {
                if (d.mailing_address_city != "" && d.mailing_address_city != null) {
                    $('#city').val(d.mailing_address_city);
                }
                if (d.mailing_address_street != "" && d.mailing_address_street != null) {
                    $('#street').val(d.mailing_address_street);
                }
                if (d.mailing_address_door != "" && d.mailing_address_door != null) {
                    $('#door').val(d.mailing_address_door);
                }
                if (d.mailing_address_apartment != "" && d.mailing_address_apartment != null) {
                    $('#apartment').val(d.mailing_address_apartment);
                }
                if (d.mailing_address_postal_code != "" && d.mailing_address_postal_code != null) {
                    $('#zipcode').val(d.mailing_address_postal_code);
                }
            }

            //更新profile信息
            function update_profile(res) {
                $('.ajax_wait p,.ajax_wait').hide();
                window.location.href = "/glacier-static/src/main/webapp/WEB-INF/template/fa_invest/international/form_step_4.html?order_number=" + order_number;
            }
        }
    })
</script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers.min.js"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-states.min.js"></script>
<script src="/static/dist/meixin_invest/js/bootstrap-formhelpers-countries-nousa.zh_CN.min.js"></script>
<script src="/static/meixin_invest/js/parsley.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa_invest_general.min.js"></script>
<script src="/static/dist/meixin_invest/js/fa.min.js"></script>
</body>
</html>