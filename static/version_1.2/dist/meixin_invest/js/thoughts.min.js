$.cookie("mx_token","",{expires:-1}),$.cookie("mx_secret","",{expires:-1}),$(document).ready(function(){function e(e){var n=new FormData($("form")[0]);n.append("file",e[0].files[0]),n.append("mx_token",$.cookie("mx_token")),n.append("mx_secret",$.cookie("mx_secret")),$.ajax({url:baseUrl+"/upload/user_file",dataType:"json",type:"post",data:n,async:!1,cache:!1,contentType:!1,processData:!1,success:function(n,a){1==n.code&&("id_card_photo"==event.target.id&&(r=n.body,console.log(r),e.siblings("p").html("您已上传的身份证照片"),e.siblings("img").attr("src",r)),"passport_photo"==event.target.id&&(i=n.body,e.siblings("p").html("您已上传的护照照片"),e.siblings("img").attr("src",i)),"identity_proof"==event.target.id&&(o=n.body,e.siblings("p").html("您已上传的汇款证明照片"),e.siblings("img").attr("src",o))),n.code==-1&&alert("上传失败,请重新上传")}})}$(".registration-form #page1").fadeIn("fast"),$('.registration-form input[type="text"], .registration-form input[type="password"], .registration-form textarea').on("focus",function(){$(this).removeClass("input-error")});var n=!0;$("#get_verify").click(function(){var e=$(this);$(this).prop("disabled",!0);var a=$("#id_telephone").val(),t=$("#countries_phone").val(),r=null,i=60;return r=setInterval(function(){$("#get_verify").html(i+"秒后重发"),i--,0==i&&(clearInterval(r),e.prop("disabled",!1),e.html("重新发送"),i=60)},1e3),("China"!=t&&a.length>6||"China"==t&&a.length>=15)&&$.ajax({type:"post",url:baseUrl+"/verify_code/send",data:{phone:a},dataType:"json",success:function(e){1==e&&(n=!0),0==e&&alert("验证码获取失败")}}),!1});var a={};$("#id_referral_code").on("blur",function(){var e=$.trim($("#id_referral_code").val());return a.referral_code=e,""!=e&&$.ajax({type:"get",url:baseUrl+"/referral_code/verify",data:a,success:function(e){return 1==e.body.code&&$(".page1-error-div").html("<div class='alert alert-warning' style='text-align:center; height: 45px; margin-top: -18px; background-color: #fff; border: none; font-size: 12px; color: orangered'>邀请码有效  注册成功后礼品卡将发送至您的邮箱!</div>"),2==e.body.code||3==e.body.code?($(".page1-error-div").html("<div class='alert alert-warning' style='text-align: center; height: 45px; margin-top: -18px; background-color: #fff; border: none; font-size: 12px; color: orangered'>亲爱的用户，邀请码失效,活动礼品已全部派完，感谢您对美信金融的关注!</div>"),!1):4==e.body.code?($(".page1-error-div").html("<div class='alert alert-warning' style='text-align: center; height: 45px; margin-top: -18px; background-color: #fff; border: none; font-size: 12px; color: orangered'>亲爱的用户,您的验证码错误,请核对后填写!</div>"),!1):void 0}}),!1}),$("#id_referral_code").on("focus",function(){$(".alert").remove()}),$(".registration-form #first-page-next-btn").on("click",function(){var e=$(this).parents(".div-group"),n=!0;e.find('input[name="phone"]'),e.find('input[name="verifyCode"]'),e.find('input[type="password"]'),e.find('input[name="email"]');if(e.find(".input-error").removeClass("input-error"),e.find('input[name="phone"], input[name="verifyCode"], input[type="password"], input[name="email"]').each(function(){if("China"==$("#countries_phone").val()&&$('input[name="phone"]').val().length<15)return $(this).addClass("input-error"),n=!1,!1;if($('input[name="verifyCode"]').val().length<6)return $("#id_verify").addClass("input-error"),n=!1,!1;if(""==$("#id_password").val())return $("#id_password").addClass("input-error"),n=!1,!1;var e=$("#id_email").val();return e.indexOf("@")==-1?($("#id_email").addClass("input-error"),n=!1,!1):e.indexOf(".")==-1?($("#id_email").addClass("input-error"),n=!1,!1):void $(this).removeClass("input-error")}),n){e.fadeOut(400,function(){$("#page1").next().fadeIn()});var t=$.trim($("#id_email").val());a.email=t,a.password=$("#id_password").val(),a.phone=$.trim($("#id_telephone").val()),a.country=$("#countries_phone").val(),a.verify_code=$("#id_verify").val(),a.referral_code=$("#id_referral_code").val(),a.is_international_investor=!0}}),$(".registration-form .btn-previous").on("click",function(){$(this).parents(".page3").fadeOut(400,function(){$("#page1").fadeIn()})}),$("#international-next-btn").on("click",function(){var e=$(this).parents("#international_page3");$('input[name="international-agree"]').is(":checked")?$.ajax({type:"post",url:baseUrl+"/auth/signup",data:a,success:function(n){if(1==n.code){var a=n.body;$.cookie("mx_token",a.mx_token,{expires:30}),$.cookie("mx_secret",a.mx_secret,{expires:30}),e.fadeOut(400,function(){$("#page4").fadeIn()})}else 1!=n.code&&($("#international-page3-error-div").html("<div class='alert alert-warning'>"+n.msg+"</div>"),$(".page1-error-div").html("<div class='alert alert-warning'>"+n.msg+"</div>"))}}):$("#international-page3-error-div").html("<div class='alert alert-warning'>请同意网站的使用条款和隐私协议</div>")}),$("#fourth-page-prev-btn").on("click",function(){var e=$(this).closest("#page4");e.fadeOut(400,function(){$("#international_page3").fadeIn()})});var t={};$("#fourth-page-next-btn").on("click",function(){var e=$(this).closest("#page4"),n=!0,a=e.find('input[name="bankname"]'),r=e.find('input[name="bankadd"]'),i=e.find('input[type="bankaccountnum"]'),o=e.find('input[name="bankaccountname"]'),d=e.find('input[name="bankSwiftCode"]'),s=e.find('input[name="ABA_Number"]');e.find('input[name="bankname"], input[name="bankadd"], input[type="bankaccountnum"], input[name="bankaccountname"], input[name="bankSwiftCode"], input[name="ABA_Number"]').each(function(){return""==$.trim($("#id_bankname").val())?($("#id_bankname").addClass("input-error"),n=!1,!1):""==$.trim($("#id_bankadd").val())?($("#id_bankadd").addClass("input-error"),n=!1,!1):0==$.trim($("#id_bankaccountnum").val().length)?($("#id_bankaccountnum").addClass("input-error"),n=!1,!1):($("#id_bankaccountnum").removeClass("input-error"),""==$.trim($("#id_bankaccountname").val())?($("#id_bankaccountname").addClass("input-error"),n=!1,!1):""==$.trim($("#id_ABA_Number").val())&&""==$.trim($("#id_bankSwiftCode").val())?($("#id_bankSwiftCode").addClass("input-error"),$("#id_ABA_Number").addClass("input-error"),n=!1,!1):""!=$.trim($("#id_ABA_Number").val())||""!=$.trim($("#id_bankSwiftCode").val())?(n=!0,$("#id_ABA_Number").removeClass("input-error"),$("#id_bankSwiftCode").removeClass("input-error"),!1):void 0)}),n&&(t.bank_name=$.trim(a),t.bank_address=$.trim(r),t.account_number=$.trim(i),t.account_name=$.trim(o),t.swift_code=$.trim(d),t.routing_number=$.trim(s),t.mx_token=$.cookie("mx_token"),t.mx_secret=$.cookie("mx_secret"),$.ajax({type:"post",url:baseUrl+"/profile/bank/update",data:t,success:function(n){if(1==n.code){n.body;console.log("ok"),e.fadeOut(400,function(){$("#page5").fadeIn()})}else console.log("fail"),$("#page4-error-div").html("<div class='alert alert-warning'>"+n.msg+"</div>")}}))}),$(".fa-upload-pic").find("a").click(function(){$(this).siblings("input").trigger("click")}),$(".fa-upload-pic input").each(function(){var n=$(this);n.change(function(a){var t=n.val().toLowerCase(),r=new RegExp("(.*?).(jpg|jpeg|png|gif|bmp)$");r.test(t)?(n.siblings("img").attr("src",URL.createObjectURL(a.target.files[0])),e(n)):(n.val(""),alert("图片格式不正确，支持图片格式(.jpg|.jpeg|.png|.gif|.bmp)"))})});var r=null,i=null,o=null;$("#fifth-page-next-btn").on("click",function(){var e=($(this).closest("#page5"),$("#user_form"));console.log();var n=$("#id_card_photo_pic").attr("data-src")==$("#id_card_photo_pic").attr("src"),a=$("#passport_photo_pic").attr("data-src")==$("#passport_photo_pic").attr("src"),t=$("#identity_proof_pic").attr("data-src")==$("#identity_proof_pic").attr("src");console.log(n),console.log(a),console.log(t);var r=!n&&!a&&!t;r&&e.fadeOut(400,function(){$(".register-ok").fadeIn()})})});